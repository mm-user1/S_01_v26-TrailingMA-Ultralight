<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S_01 TrailingMA — Backtester + Optimizer</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: #e8e8e8;
      color: #1f1f1f;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    header {
      background: #4a4a4a;
      color: #ffffff;
      padding: 16px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      margin-bottom: 24px;
    }

    header h1 {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 4px;
    }

    header p {
      margin: 0;
      font-size: 13px;
      color: #dddddd;
    }

    .grid {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    section {
      background: #f7f7f7;
      border: 1px solid #cccccc;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }

    section h2 {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 16px;
      color: #3a3a3a;
    }

    .param-row {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 16px;
      padding: 12px 14px;
      border-radius: 6px;
      border: 1px solid #e1e1e1;
      background: #ffffff;
      margin-bottom: 10px;
    }

    .param-row:last-child {
      margin-bottom: 0;
    }

    .left-side {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
    }

    .left-side label,
    .right-side label {
      font-size: 13px;
      color: #2a2a2a;
    }

    .left-side input[type="number"],
    .left-side input[type="text"],
    .left-side select,
    .right-side input[type="number"],
    .right-side input[type="text"] {
      background: #ffffff;
      border: 1px solid #bdbdbd;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 13px;
      color: #1f1f1f;
    }

    .left-side input[type="file"] {
      font-size: 13px;
    }

    .inline {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    .checkbox-inline input {
      width: 16px;
      height: 16px;
    }

    .right-side {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      min-height: 32px;
    }

    .right-side.empty::after {
      content: "";
    }

    .range-input {
      width: 120px;
      text-align: center;
    }

    .step-input {
      width: 70px;
    }

    .ma-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
      background: #fcfcfc;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      padding: 12px;
      width: 100%;
    }

    .ma-selector .ma-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .ma-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    .ma-option input {
      width: 16px;
      height: 16px;
    }

    .results-area {
      background: #ffffff;
      border: 1px solid #c5c5c5;
      border-radius: 6px;
      padding: 14px;
      min-height: 160px;
      font-size: 13px;
      color: #666666;
      white-space: pre-wrap;
    }

    .button-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 18px;
      gap: 12px;
    }

    button {
      border: none;
      border-radius: 4px;
      padding: 8px 18px;
      font-size: 14px;
      cursor: pointer;
      background: #4a4a4a;
      color: #ffffff;
      transition: background 0.2s ease;
    }

    button.secondary {
      background: #d0d0d0;
      color: #1f1f1f;
    }

    button:hover {
      background: #3a3a3a;
    }

    button.secondary:hover {
      background: #bdbdbd;
    }

    .info-box {
      margin-top: 12px;
      background: #fff8d8;
      border: 1px solid #e0c36a;
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
      color: #5e4c1f;
      line-height: 1.5;
    }

    @media (max-width: 960px) {
      .param-row {
        grid-template-columns: 1fr;
      }

      .right-side {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <header>
      <h1>S_01 TrailingMA — Backtester и Optimizer в одном окне</h1>
      <p>Выберите значения слева для бэктеста и включайте диапазоны справа, чтобы добавить параметр в перебор.</p>
    </header>

    <form class="grid" id="backtestForm">
      <section>
        <h2>Дата и источник данных</h2>
        <div class="param-row">
          <div class="left-side">
            <label class="checkbox-inline"><input type="checkbox" id="dateFilter" />Date Filter</label>
            <label class="checkbox-inline"><input type="checkbox" id="backtester" />Backtester</label>
          </div>
          <div class="right-side empty"></div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="startDate">Start Date</label>
            <input type="text" id="startDate" placeholder="YYYY-MM-DD" />
            <label for="startTime">Time</label>
            <input type="text" id="startTime" placeholder="HH:MM" style="width: 80px;" />
          </div>
          <div class="right-side empty"></div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="endDate">End Date</label>
            <input type="text" id="endDate" placeholder="YYYY-MM-DD" />
            <label for="endTime">Time</label>
            <input type="text" id="endTime" placeholder="HH:MM" style="width: 80px;" />
          </div>
          <div class="right-side empty"></div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="csvFile">CSV файл (OHLCV)</label>
            <input type="file" id="csvFile" accept=".csv" />
          </div>
          <div class="right-side empty"></div>
        </div>
      </section>

      <section>
        <h2>Trend Moving Average</h2>
        <div class="param-row">
          <div class="left-side" style="flex-direction: column; align-items: stretch; gap: 12px;">
            <label>T MA Type</label>
            <div class="ma-selector" data-group="trend">
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trend-all" data-group="trend" data-type="ALL" />ALL</label>
                <label class="ma-option"><input type="checkbox" id="trend-ema" data-group="trend" data-type="EMA" />EMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-sma" data-group="trend" data-type="SMA" />SMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-hma" data-group="trend" data-type="HMA" />HMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-wma" data-group="trend" data-type="WMA" />WMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-alma" data-group="trend" data-type="ALMA" />ALMA</label>
              </div>
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trend-kama" data-group="trend" data-type="KAMA" />KAMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-tma" data-group="trend" data-type="TMA" />TMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-t3" data-group="trend" data-type="T3" />T3</label>
                <label class="ma-option"><input type="checkbox" id="trend-dema" data-group="trend" data-type="DEMA" />DEMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-vwma" data-group="trend" data-type="VWMA" />VWMA</label>
                <label class="ma-option"><input type="checkbox" id="trend-vwap" data-group="trend" data-type="VWAP" />VWAP</label>
              </div>
            </div>
          </div>
          <div class="right-side empty"></div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="maLength">Length</label>
            <input type="number" id="maLength" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-maLength" />Вкл</label>
            <input type="text" class="range-input" id="opt-maLength-range" value="50-500" />
            <label for="opt-maLength-step">Step</label>
            <input type="number" class="step-input" id="opt-maLength-step" min="1" value="1" />
          </div>
        </div>
      </section>

      <section>
        <h2>Entries</h2>
        <div class="param-row">
          <div class="left-side">
            <label for="closeCountLong">Close Count Long</label>
            <input type="number" id="closeCountLong" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-closeCountLong" />Вкл</label>
            <input type="text" class="range-input" id="opt-closeCountLong-range" value="5-10" />
            <label for="opt-closeCountLong-step">Step</label>
            <input type="number" class="step-input" id="opt-closeCountLong-step" min="1" value="1" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="closeCountShort">Close Count Short</label>
            <input type="number" id="closeCountShort" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-closeCountShort" />Вкл</label>
            <input type="text" class="range-input" id="opt-closeCountShort-range" value="3-8" />
            <label for="opt-closeCountShort-step">Step</label>
            <input type="number" class="step-input" id="opt-closeCountShort-step" min="1" value="1" />
          </div>
        </div>
      </section>

      <section>
        <h2>Stops и фильтры</h2>
        <div class="param-row">
          <div class="left-side">
            <label for="stopLongX">Stop Long X</label>
            <input type="number" id="stopLongX" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopLongX" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopLongX-range" value="1.5-3.0" />
            <label for="opt-stopLongX-step">Step</label>
            <input type="number" class="step-input" id="opt-stopLongX-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopLongRR">Stop Long RR</label>
            <input type="number" id="stopLongRR" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopLongRR" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopLongRR-range" value="2.0-4.0" />
            <label for="opt-stopLongRR-step">Step</label>
            <input type="number" class="step-input" id="opt-stopLongRR-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopLongLP">Stop Long LP</label>
            <input type="number" id="stopLongLP" min="1" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopLongLP" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopLongLP-range" value="1-5" />
            <label for="opt-stopLongLP-step">Step</label>
            <input type="number" class="step-input" id="opt-stopLongLP-step" min="1" value="1" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopShortX">Stop Short X</label>
            <input type="number" id="stopShortX" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopShortX" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopShortX-range" value="1.5-3.0" />
            <label for="opt-stopShortX-step">Step</label>
            <input type="number" class="step-input" id="opt-stopShortX-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopShortRR">Stop Short RR</label>
            <input type="number" id="stopShortRR" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopShortRR" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopShortRR-range" value="2.0-4.0" />
            <label for="opt-stopShortRR-step">Step</label>
            <input type="number" class="step-input" id="opt-stopShortRR-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopShortLP">Stop Short LP</label>
            <input type="number" id="stopShortLP" min="1" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopShortLP" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopShortLP-range" value="1-5" />
            <label for="opt-stopShortLP-step">Step</label>
            <input type="number" class="step-input" id="opt-stopShortLP-step" min="1" value="1" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopLongMaxPct">L Stop Max %</label>
            <input type="number" id="stopLongMaxPct" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopLongMaxPct" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopLongMaxPct-range" value="2.0-5.0" />
            <label for="opt-stopLongMaxPct-step">Step</label>
            <input type="number" class="step-input" id="opt-stopLongMaxPct-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopShortMaxPct">S Stop Max %</label>
            <input type="number" id="stopShortMaxPct" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopShortMaxPct" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopShortMaxPct-range" value="2.0-5.0" />
            <label for="opt-stopShortMaxPct-step">Step</label>
            <input type="number" class="step-input" id="opt-stopShortMaxPct-step" step="0.1" value="0.5" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopLongMaxDays">L Stop Max D</label>
            <input type="number" id="stopLongMaxDays" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopLongMaxDays" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopLongMaxDays-range" value="1-5" />
            <label for="opt-stopLongMaxDays-step">Step</label>
            <input type="number" class="step-input" id="opt-stopLongMaxDays-step" min="1" value="1" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="stopShortMaxDays">S Stop Max D</label>
            <input type="number" id="stopShortMaxDays" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-stopShortMaxDays" />Вкл</label>
            <input type="text" class="range-input" id="opt-stopShortMaxDays-range" value="2-6" />
            <label for="opt-stopShortMaxDays-step">Step</label>
            <input type="number" class="step-input" id="opt-stopShortMaxDays-step" min="1" value="1" />
          </div>
        </div>
      </section>

      <section>
        <h2>Trailing Stops</h2>
        <div class="param-row">
          <div class="left-side">
            <label for="trailRRLong">Trail RR Long</label>
            <input type="number" id="trailRRLong" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-trailRRLong" />Вкл</label>
            <input type="text" class="range-input" id="opt-trailRRLong-range" value="0.5-2.0" />
            <label for="opt-trailRRLong-step">Step</label>
            <input type="number" class="step-input" id="opt-trailRRLong-step" step="0.01" value="0.25" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side">
            <label for="trailRRShort">Trail RR Short</label>
            <input type="number" id="trailRRShort" step="0.1" min="0" />
          </div>
          <div class="right-side">
            <label class="checkbox-inline"><input type="checkbox" id="opt-trailRRShort" />Вкл</label>
            <input type="text" class="range-input" id="opt-trailRRShort-range" value="0.5-2.0" />
            <label for="opt-trailRRShort-step">Step</label>
            <input type="number" class="step-input" id="opt-trailRRShort-step" step="0.01" value="0.25" />
          </div>
        </div>
        <div class="param-row">
          <div class="left-side" style="flex-direction: column; align-items: stretch; gap: 12px;">
            <div class="inline" style="justify-content: space-between;">
              <label>Trail MA Long</label>
            </div>
            <div class="ma-selector" data-group="trailLong">
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trailLong-all" data-group="trailLong" data-type="ALL" />ALL</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-ema" data-group="trailLong" data-type="EMA" />EMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-sma" data-group="trailLong" data-type="SMA" />SMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-hma" data-group="trailLong" data-type="HMA" />HMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-wma" data-group="trailLong" data-type="WMA" />WMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-alma" data-group="trailLong" data-type="ALMA" />ALMA</label>
              </div>
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trailLong-kama" data-group="trailLong" data-type="KAMA" />KAMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-tma" data-group="trailLong" data-type="TMA" />TMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-t3" data-group="trailLong" data-type="T3" />T3</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-dema" data-group="trailLong" data-type="DEMA" />DEMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-vwma" data-group="trailLong" data-type="VWMA" />VWMA</label>
                <label class="ma-option"><input type="checkbox" id="trailLong-vwap" data-group="trailLong" data-type="VWAP" />VWAP</label>
              </div>
              <div class="inline">
                <label for="trailLongLength">Length</label>
                <input type="number" id="trailLongLength" min="0" />
                <label for="trailLongOffset">Offset</label>
                <input type="number" id="trailLongOffset" step="0.1" />
              </div>
            </div>
          </div>
          <div class="right-side">
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <div class="inline" style="flex-wrap: wrap; gap: 10px;">
                <label class="checkbox-inline"><input type="checkbox" id="opt-trailLongLength" />Length</label>
                <input type="text" class="range-input" id="opt-trailLongLength-range" value="100-200" />
                <label for="opt-trailLongLength-step">Step</label>
                <input type="number" class="step-input" id="opt-trailLongLength-step" min="1" value="20" />
              </div>
              <div class="inline" style="flex-wrap: wrap; gap: 10px;">
                <label class="checkbox-inline"><input type="checkbox" id="opt-trailLongOffset" />Offset</label>
                <input type="text" class="range-input" id="opt-trailLongOffset-range" value="-2.0-0.0" />
                <label for="opt-trailLongOffset-step">Step</label>
                <input type="number" class="step-input" id="opt-trailLongOffset-step" step="0.1" value="0.5" />
              </div>
            </div>
          </div>
        </div>
        <div class="param-row">
          <div class="left-side" style="flex-direction: column; align-items: stretch; gap: 12px;">
            <div class="inline" style="justify-content: space-between;">
              <label>Trail MA Short</label>
            </div>
            <div class="ma-selector" data-group="trailShort">
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trailShort-all" data-group="trailShort" data-type="ALL" />ALL</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-ema" data-group="trailShort" data-type="EMA" />EMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-sma" data-group="trailShort" data-type="SMA" />SMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-hma" data-group="trailShort" data-type="HMA" />HMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-wma" data-group="trailShort" data-type="WMA" />WMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-alma" data-group="trailShort" data-type="ALMA" />ALMA</label>
              </div>
              <div class="ma-row">
                <label class="ma-option"><input type="checkbox" id="trailShort-kama" data-group="trailShort" data-type="KAMA" />KAMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-tma" data-group="trailShort" data-type="TMA" />TMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-t3" data-group="trailShort" data-type="T3" />T3</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-dema" data-group="trailShort" data-type="DEMA" />DEMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-vwma" data-group="trailShort" data-type="VWMA" />VWMA</label>
                <label class="ma-option"><input type="checkbox" id="trailShort-vwap" data-group="trailShort" data-type="VWAP" />VWAP</label>
              </div>
              <div class="inline">
                <label for="trailShortLength">Length</label>
                <input type="number" id="trailShortLength" min="0" />
                <label for="trailShortOffset">Offset</label>
                <input type="number" id="trailShortOffset" step="0.1" />
              </div>
            </div>
          </div>
          <div class="right-side">
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <div class="inline" style="flex-wrap: wrap; gap: 10px;">
                <label class="checkbox-inline"><input type="checkbox" id="opt-trailShortLength" />Length</label>
                <input type="text" class="range-input" id="opt-trailShortLength-range" value="100-200" />
                <label for="opt-trailShortLength-step">Step</label>
                <input type="number" class="step-input" id="opt-trailShortLength-step" min="1" value="20" />
              </div>
              <div class="inline" style="flex-wrap: wrap; gap: 10px;">
                <label class="checkbox-inline"><input type="checkbox" id="opt-trailShortOffset" />Offset</label>
                <input type="text" class="range-input" id="opt-trailShortOffset-range" value="0.0-2.0" />
                <label for="opt-trailShortOffset-step">Step</label>
                <input type="number" class="step-input" id="opt-trailShortOffset-step" step="0.1" value="0.5" />
              </div>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Риск-менеджмент</h2>
        <div class="param-row">
          <div class="left-side">
            <label for="riskPerTrade">Risk Per Trade</label>
            <input type="number" id="riskPerTrade" step="0.01" min="0" />
            <label for="contractSize">Contract Size</label>
            <input type="number" id="contractSize" step="0.01" min="0" />
          </div>
          <div class="right-side empty"></div>
        </div>
      </section>

      <section>
        <h2>Результаты и запуск</h2>
        <div class="results-area" id="results">Нажмите «Run» для запуска бэктеста…</div>
        <div class="button-row">
          <button type="button" class="secondary" id="defaultsBtn">Defaults</button>
          <div style="display: flex; gap: 10px;">
            <button type="button" class="secondary" id="cancelBtn">Cancel</button>
            <button type="submit" id="runBtn">Run</button>
          </div>
        </div>
        <div class="info-box">
          • Отметьте чекбоксы справа, чтобы добавить параметр в перебор.<br />
          • Диапазон указывается в одном поле в формате «минимум-максимум».<br />
          • Шаг задаётся отдельным числовым полем.<br />
          • MA-типы выбираются в левой колонке и используются в обеих логиках.
        </div>
      </section>
    </form>
  </div>

  <script>
    const MA_TYPES = ['EMA', 'SMA', 'HMA', 'WMA', 'ALMA', 'KAMA', 'TMA', 'T3', 'DEMA', 'VWMA', 'VWAP'];

    function syncGroupFromAll(groupName) {
      const allCheckbox = document.querySelector(`input[data-group="${groupName}"][data-type="ALL"]`);
      const members = Array.from(document.querySelectorAll(`input[data-group="${groupName}"]:not([data-type="ALL"])`));
      if (!allCheckbox) return;
      allCheckbox.addEventListener('change', () => {
        members.forEach((checkbox) => {
          checkbox.checked = allCheckbox.checked;
        });
      });
      members.forEach((checkbox) => {
        checkbox.addEventListener('change', () => {
          const allChecked = members.every((cb) => cb.checked);
          allCheckbox.checked = allChecked;
        });
      });
    }

    ['trend', 'trailLong', 'trailShort'].forEach(syncGroupFromAll);

    const defaults = {
      dateFilter: true,
      backtester: true,
      startDate: '2025-04-01',
      startTime: '00:00',
      endDate: '2025-09-01',
      endTime: '00:00',
      maLength: 45,
      closeCountLong: 7,
      closeCountShort: 5,
      stopLongX: 2,
      stopLongRR: 3,
      stopLongLP: 2,
      stopShortX: 2,
      stopShortRR: 3,
      stopShortLP: 2,
      stopLongMaxPct: 3,
      stopShortMaxPct: 3,
      stopLongMaxDays: 2,
      stopShortMaxDays: 4,
      trailRRLong: 1,
      trailRRShort: 1,
      trailLongLength: 160,
      trailLongOffset: -1,
      trailShortLength: 160,
      trailShortOffset: 1,
      riskPerTrade: 2,
      contractSize: 0.01
    };

    function applyDefaults() {
      document.getElementById('dateFilter').checked = defaults.dateFilter;
      document.getElementById('backtester').checked = defaults.backtester;
      document.getElementById('startDate').value = defaults.startDate;
      document.getElementById('startTime').value = defaults.startTime;
      document.getElementById('endDate').value = defaults.endDate;
      document.getElementById('endTime').value = defaults.endTime;
      document.getElementById('maLength').value = defaults.maLength;
      document.getElementById('closeCountLong').value = defaults.closeCountLong;
      document.getElementById('closeCountShort').value = defaults.closeCountShort;
      document.getElementById('stopLongX').value = defaults.stopLongX;
      document.getElementById('stopLongRR').value = defaults.stopLongRR;
      document.getElementById('stopLongLP').value = defaults.stopLongLP;
      document.getElementById('stopShortX').value = defaults.stopShortX;
      document.getElementById('stopShortRR').value = defaults.stopShortRR;
      document.getElementById('stopShortLP').value = defaults.stopShortLP;
      document.getElementById('stopLongMaxPct').value = defaults.stopLongMaxPct;
      document.getElementById('stopShortMaxPct').value = defaults.stopShortMaxPct;
      document.getElementById('stopLongMaxDays').value = defaults.stopLongMaxDays;
      document.getElementById('stopShortMaxDays').value = defaults.stopShortMaxDays;
      document.getElementById('trailRRLong').value = defaults.trailRRLong;
      document.getElementById('trailRRShort').value = defaults.trailRRShort;
      document.getElementById('trailLongLength').value = defaults.trailLongLength;
      document.getElementById('trailLongOffset').value = defaults.trailLongOffset;
      document.getElementById('trailShortLength').value = defaults.trailShortLength;
      document.getElementById('trailShortOffset').value = defaults.trailShortOffset;
      document.getElementById('riskPerTrade').value = defaults.riskPerTrade;
      document.getElementById('contractSize').value = defaults.contractSize;

      ['trend', 'trailLong', 'trailShort'].forEach((group) => {
        const allCheckbox = document.querySelector(`input[data-group="${group}"][data-type="ALL"]`);
        const members = Array.from(document.querySelectorAll(`input[data-group="${group}"]:not([data-type="ALL"])`));
        const source = new Set(MA_TYPES);
        if (allCheckbox) {
          allCheckbox.checked = true;
        }
        members.forEach((checkbox) => {
          checkbox.checked = source.has(checkbox.dataset.type);
        });
      });

      document.getElementById('results').textContent = 'Нажмите «Run» для запуска бэктеста…';
    }

    applyDefaults();

    document.getElementById('defaultsBtn').addEventListener('click', applyDefaults);
  </script>
</body>
</html>
